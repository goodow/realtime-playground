language: node_js
node_js:
- 0.10

branches:
  only:
    - master

before_install:
- git config --global user.name "Goodow Dev"
- git config --global user.email "dev@goodow.com"
- git remote set-url origin "https://${GH_TOKEN}@github.com/goodow/realtime-web-playground.git"
- git fetch origin gh-pages:gh-pages

before_script:
- export DISPLAY=:99.0
- sh -e /etc/init.d/xvfb start
- npm start > /dev/null &
- npm run update-webdriver
- sleep 1

after_success:
- cp -r app/ .gh-pages/
- git checkout gh-pages && cp -r .gh-pages/* . && rm -rf .gh-pages/ app/ node_modules/
- git add . && git commit -m "Generated by ${TRAVIS_COMMIT}"
- test ${TRAVIS_PULL_REQUEST} == "false" && git push origin

env:
  global:
    secure: gECuwl39mTQ1XRBBYAkrD42YUj1p0fdDlDIbjRBQaxLdUVNvPHZiV0/jTJgnvG+lEwJNIAaDGuw+rIK+/+VlbVE6LWQgRuwAB5eBI18NFNNytXUvvnS2IREYKRGPuRwC4a51V3Q0L+zTyg8xVzNQSNl7N2J/znVBUlXMCzAy95E=
